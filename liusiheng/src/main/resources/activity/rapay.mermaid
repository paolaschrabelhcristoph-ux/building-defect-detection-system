flowchart TD
    A[用户选择要还的借阅记录] --> B[点击还书按钮]
    B --> C[查找借阅记录]
    C --> D{借阅记录存在?}
    D -->|否| E[显示错误: 借阅记录不存在]
    D -->|是| F{借阅状态是BORROWED?}
    F -->|否| G[显示错误: 图书已归还或状态异常]
    F -->|是| H[计算是否逾期]
    H --> I{是否逾期?}
    I -->|是| J[计算罚款金额]
    I -->|否| K[罚款为0]
    J --> L[更新图书可用数量]
    K --> L
    L --> M[更新借阅记录状态为RETURNED]
    M --> N[设置还书日期]
    N --> O[保存更新后的借阅记录]
    O --> P[显示还书成功信息]
    E --> Q[结束]
    G --> Q
    P --> Q